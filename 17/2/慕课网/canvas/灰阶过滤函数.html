<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>灰阶过滤器</title>
</head>
<body>
  
  <canvas id="canvas" style="border:1px solid violet;margin:10px auto;">
  	你的浏览器不支持canvas,请更换浏览器再试。
  </canvas>
  <img src="images/girl2.jpg" alt="图片">

  <script>
  //由于chrome不支持本地的file:///协议，需要在服务器上才行。在火狐上是可以看到效果的。
    window.onload = function(){
      var canvas = document.getElementById("canvas");
      canvas.width = 650;
      canvas.height = 600;

  	  var context = canvas.getContext("2d"),
      //document.images[]获取页面中的image元素中的第一个，中括号中的参数除了是数字外，还可以是有name属性的图片的 name值(字符串形式);
      image = document.images[0], 
  		imageData, data, i, len, average, red, green, blue,alpha;

  	  context.drawImage(image,0,0);  //绘制原始图像

    //getImageData方法取得图像数据(4个参数:开始点位置,获取的长宽)
  	  imageData = context.getImageData(0,0,image.width,image.height);
  	  data = imageData.data;

//getImageData方法返回的对象是ImageData的实例,每个实例有三个属性:width,height,data，其中data是一个数组，保存有图像中每一个像素的数据，分别是红绿蓝和透明度
  	  for(i = 0, len = data.length; i < len; i++){
  	  	red = data[i];
  	  	green = data[i+1];
  	  	blue = data[i+2];
  	  	alpha = data[i+3];

  	  	average = Math.floor((red + green + blue) / 3);

  	  	data[i] = average;
  	  	data[i+1] = average;
  	  	data[i+2] = average;
  	  }

      //回写图像数据并显示结果
  	  imageData.data = data;
  	  context.putImageData(imageData,0,0);

    }
  </script>	
</body>
</html>