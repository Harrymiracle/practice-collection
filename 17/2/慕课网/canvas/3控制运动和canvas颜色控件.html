<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>控制运动和canvas颜色</title>
  <style>
	#wrapper{
	  width: 1200px;
	  height: 600px;
	  position: relative;
	  margin: 30px auto;
	}
	#canvas{
	  border:1px solid gray;
	  border-radius: 8px;
	}
	#controller{
	  position: absolute;
	  top: 20px; left: 20px;
	  border-radius: 10px;
	  padding: 5px 20px 25px 20px;
	  background: rgba(0,85,116,0.7);
	}
	h3{
	  color: white;
	  font-family: Microsoft Yahei;
	  font-weight: bold;
	}
	#canvas-btn{
	  background: #8b0;
	  color: white;
	  padding: 5px 15px;
	  font-size: 14px;
	  border-radius: 6px;
	  margin: 10px 0 0 20px;
	}
	#canvas-btn:hover{
	  background: #7a0;
	  cursor: pointer;
	}
	.color-btn{
	  padding: 5px 15px;
	  font-size: 14px;
	  border-radius: 6px;
	  margin: 10px 5px 0 0;
	}
	.color-btn:hover{cursor: pointer;}
	#white-btn{background: white;}
	#black-btn{background: black;}
  </style>
</head>
<body>
  <div id="wrapper">
  	<canvas id="canvas">
  	  你的浏览器不支持canvas,请更换浏览器再试。
    </canvas>
  	<div id="controller">
  	  <h3>Canvas绘图之旅</h3>
  	  <span id="canvas-btn">停止运动</span>
  	  <span class="color-btn" id="white-btn">&nbsp;</span>
  	  <span class="color-btn" id="black-btn">&nbsp;</span>
  	</div>
  </div>

  <script>
  	var balls = [];	//初始化装小球的空数组
  	var isMoving = true;  //设置开关
  	var themeColor = "white";	//初始化主题颜色为白色

  	window.onload = function(){
  	  var canvas = document.getElementById("canvas");
  	  canvas.width = 1200;
  	  canvas.height = 600;

  	  var context = canvas.getContext("2d");

  	  for(var i = 0; i < 80; i++){
  	  	var R = Math.floor(Math.random()*255);	//循环随机生成 rgb和小球半径
  	  	var G = Math.floor(Math.random()*255);
  	  	var B = Math.floor(Math.random()*255);
  	  	var radius = Math.random()*20 + 30; 
  	  	var aball = {  //创建储存小球信息的对象
  	  	  color: "rgb(" + R + "," + G + "," + B + ")", 
  	  	  radius: radius,
  	  	  x: Math.random()*(canvas.width - 2*radius) + radius,
  	  	  y: Math.random()*(canvas.height - 2*radius) + radius,
  	  	  vx: (Math.random()*1+2) * Math.pow(-1, Math.floor(Math.random()*100)),
  	  	  vy: (Math.random()*1+1) * Math.pow(-1, Math.floor(Math.random()*100))
  	  	}
  	  	balls[i] = aball;	//将小球对象一个一个地加到数组中
  	  }

  	  setInterval(function(){
  	  	draw(context);
  	  	if(isMoving){
  	  	  update(canvas.width,canvas.height);
  	  	}
  	  },30);

  	  document.getElementById("canvas-btn").onclick = function(){
  	  	if(isMoving){
  	  	  isMoving = false;
  	  	  this.innerHTML = "开始跑起"; //a元素为text,此处为span
  	  	}else{
  	  	  isMoving = true;
  	  	  this.innerHTML = "停止运动";
  	  	}
  	  	return false;
  	  }
  	  document.getElementById("white-btn").onclick = function(event){
  	  	themeColor = "white";
  	  	return false;
  	  }
  	  document.getElementById("black-btn").onclick = function(event){
  	  	themeColor = "black";
  	  	return false;
  	  }

  	}


  	function draw(cxt){
  	  var canvas = cxt.canvas;
  	  cxt.clearRect(0,0,canvas.width,canvas.height); //绘制前先清空之前的画布

  	  if(themeColor == "black"){ //先绘制背景(背景是黑色才进入这个if代码块)
  	  	cxt.fillStyle = "black";
  	  	cxt.fillRect(0,0,canvas.width,canvas.height);
  	  }

  	  for(var i = 0, len = balls.length; i < len; i++){  //循环绘制小球
  	  	cxt.fillStyle = balls[i].color;
  	  	cxt.beginPath();
  	  	cxt.arc(balls[i].x, balls[i].y, balls[i].radius, 0, 2*Math.PI);
  	  	cxt.closePath();
  	  	cxt.fill();
  	  }
  	}

  	function update(canvasWidth,canvasHeight){
  	  for(var i = 0, len = balls.length; i < len; i++){

  	  	balls[i].x += balls[i].vx;
  	  	balls[i].y += balls[i].vy;

  	  	if(balls[i].x - balls[i].radius <= 0){
  	  	  balls[i].x = balls[i].radius;
  	  	  balls[i].vx = -balls[i].vx;
  	  	}
  	  	if(balls[i].x + balls[i].radius >= canvasWidth){
  	  	  balls[i].x = canvasWidth -balls[i].radius;
  	  	  balls[i].vx = -balls[i].vx;
  	  	}
  	  	if(balls[i].y - balls[i].radius <= 0){
  	  	  balls[i].y = balls[i].radius;
  	  	  balls[i].vy = -balls[i].vy;
  	  	}
  	  	if(balls[i].y + balls[i].radius >= canvasHeight){
  	  	  balls[i].y = canvasHeight -balls[i].radius;
  	  	  balls[i].vy = -balls[i].vy;
  	  	}
  	  }	  
  	}

  </script>
</body>
</html>